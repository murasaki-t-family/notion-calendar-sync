# 要件定義

## 概要

GoogleカレンダーのイベントをNotionデータベースへ自動同期するGoogle Apps Script (GAS) プロジェクト。
スプレッドシートの「Control」シートから設定値を読み込み、定期実行トリガーで稼働する。

## 機能要件

### 同期機能

| 機能 | 説明 |
|------|------|
| 初期同期 | 未来N日分（設定可能）のイベントを一括でNotionに登録 |
| 増分同期 | 前回同期以降に変更があったイベントのみを処理 |
| 定期実行 | 指定間隔（デフォルト5分）で自動同期 |
| 複数カレンダー対応 | カンマ区切りで複数のGoogleカレンダーIDを指定可能 |

### イベント処理

| 操作 | 動作 |
|------|------|
| 新規イベント | Notionにページを作成 |
| イベント更新 | 既存のNotionページを更新 |
| イベント削除 | Notionページをアーカイブ |

### 同期対象外の条件

- 終日イベント（`start.date` が存在し `start.dateTime` が存在しない）
- タイトルが `---` で始まるイベント

### 同期されるデータ

| Notionプロパティ | Googleカレンダーのフィールド |
|------------------|------------------------------|
| Name（タイトル） | summary（イベント名） |
| 日付 | start / end（開始・終了日時） |
| イベントID | id（GoogleカレンダーのイベントID） |
| 最終更新日時(GAS) | updated（更新日時） |

## 非機能要件

### 信頼性

- ロック機構による同時実行の防止
- API呼び出し失敗時に指数バックオフで最大3回リトライ
- 5分の実行時間制限を考慮した中断・再開処理

### パフォーマンス

- 50件ずつのバッチ処理でAPI制限に対応
- ページネーション対応で大量イベントを処理可能

## 制約事項

- Google Apps Scriptの実行時間制限（6分）に対応するため、5分で中断して再スケジュール
- Notion API のレート制限を考慮したリトライ機構が必要
- スプレッドシートがバインドされている必要がある（設定値の読み込みのため）
